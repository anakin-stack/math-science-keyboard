{"ast":null,"code":"\"use strict\";\n\nconst DOMException = require(\"domexception\");\nconst StorageEvent = require(\"../generated/StorageEvent\");\nconst idlUtils = require(\"../generated/utils\");\n\n// https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\nclass StorageImpl {\n  constructor(args, _ref) {\n    let {\n      associatedWindow,\n      storageArea,\n      url,\n      type,\n      storageQuota\n    } = _ref;\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n  }\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin.filter(target => target !== this._associatedWindow).forEach(target => target.dispatchEvent(StorageEvent.create([\"storage\", {\n      bubbles: false,\n      cancelable: false,\n      key,\n      oldValue,\n      newValue,\n      url: this._url,\n      storageArea: target[\"_\" + this._type]\n    }])));\n  }\n  get length() {\n    return this._items.size;\n  }\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n    return [...this._items.keys()][n];\n  }\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n    return null;\n  }\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n    if (oldValue === value) {\n      return;\n    }\n\n    // Concatenate all keys and values to measure their length against the quota\n    let itemsTotalLength = key.length + value.length;\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n    if (itemsTotalLength > this._quota) {\n      throw new DOMException(`The ${this._quota}-code unit storage quota has been exceeded.`, \"QuotaExceededError\");\n    }\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n    this._items.set(key, value);\n  }\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n      this._items.delete(key);\n    }\n  }\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n      this._items.clear();\n    }\n  }\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n}\nmodule.exports = {\n  implementation: StorageImpl\n};","map":{"version":3,"names":["DOMException","require","StorageEvent","idlUtils","StorageImpl","constructor","args","_ref","associatedWindow","storageArea","url","type","storageQuota","_associatedWindow","_items","_url","_type","_quota","_dispatchStorageEvent","key","oldValue","newValue","_currentOriginData","windowsInSameOrigin","filter","target","forEach","dispatchEvent","create","bubbles","cancelable","length","size","n","keys","getItem","has","get","setItem","value","itemsTotalLength","curKey","curValue","setTimeout","bind","set","removeItem","delete","clear","supportedPropertyNames","module","exports","implementation"],"sources":["G:/scientificKeyboard/keyboard/node_modules/mathjax-node/node_modules/jsdom/lib/jsdom/living/webstorage/Storage-impl.js"],"sourcesContent":["\"use strict\";\n\nconst DOMException = require(\"domexception\");\nconst StorageEvent = require(\"../generated/StorageEvent\");\nconst idlUtils = require(\"../generated/utils\");\n\n// https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\nclass StorageImpl {\n  constructor(args, { associatedWindow, storageArea, url, type, storageQuota }) {\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n  }\n\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin\n      .filter(target => target !== this._associatedWindow)\n      .forEach(target => target.dispatchEvent(StorageEvent.create([\n        \"storage\",\n        {\n          bubbles: false,\n          cancelable: false,\n          key,\n          oldValue,\n          newValue,\n          url: this._url,\n          storageArea: target[\"_\" + this._type]\n        }\n      ])));\n  }\n\n  get length() {\n    return this._items.size;\n  }\n\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n    return [...this._items.keys()][n];\n  }\n\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n    return null;\n  }\n\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n\n    if (oldValue === value) {\n      return;\n    }\n\n    // Concatenate all keys and values to measure their length against the quota\n    let itemsTotalLength = key.length + value.length;\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n    if (itemsTotalLength > this._quota) {\n      throw new DOMException(`The ${this._quota}-code unit storage quota has been exceeded.`, \"QuotaExceededError\");\n    }\n\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n\n    this._items.set(key, value);\n  }\n\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n\n      this._items.delete(key);\n    }\n  }\n\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n\n      this._items.clear();\n    }\n  }\n\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n}\n\nmodule.exports = {\n  implementation: StorageImpl\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}