{"ast":null,"code":"\"use strict\";\n\nconst conversions = require(\"webidl-conversions\");\nconst HTMLElementImpl = require(\"./HTMLElement-impl\").implementation;\nconst resourceLoader = require(\"../../browser/resource-loader\");\nconst {\n  Canvas,\n  reflectURLAttribute\n} = require(\"../../utils\");\nclass HTMLImageElementImpl extends HTMLElementImpl {\n  _attrModified(name, value, oldVal) {\n    if (name === \"src\" && value !== oldVal) {\n      const document = this._ownerDocument;\n      if (Canvas && document.implementation._hasFeature(\"FetchExternalResources\", \"img\")) {\n        let error;\n        if (!this._image) {\n          this._image = new Canvas.Image();\n          // Install an error handler that just remembers the error. It is then\n          // thrown in the callback of resourceLoader.load() below.\n          this._image.onerror = function (err) {\n            error = err;\n          };\n        }\n        this._currentSrc = null;\n        if (this.hasAttribute(\"src\")) {\n          resourceLoader.load(this, this.src, {}, (data, url, response) => {\n            if (response && response.statusCode !== undefined && response.statusCode !== 200) {\n              throw new Error(\"Status code: \" + response.statusCode);\n            }\n            error = null;\n            this._image.source = data;\n            if (error) {\n              throw new Error(error);\n            }\n            this._currentSrc = value;\n          });\n        } else {\n          this._image.source = undefined;\n        }\n      }\n    }\n    super._attrModified(name, value, oldVal);\n  }\n  get _accept() {\n    return \"image/png,image/*;q=0.8,*/*;q=0.5\";\n  }\n  get src() {\n    return reflectURLAttribute(this, \"src\");\n  }\n  set src(value) {\n    this.setAttribute(\"src\", value);\n  }\n  get srcset() {\n    return conversions.USVString(this.getAttribute(\"srcset\"));\n  }\n  set srcset(value) {\n    this.setAttribute(\"srcset\", value);\n  }\n  get height() {\n    // Just like on browsers, if no width / height is defined, we fall back on the\n    // dimensions of the internal image data.\n    return this.hasAttribute(\"height\") ? conversions[\"unsigned long\"](this.getAttribute(\"height\")) : this.naturalHeight;\n  }\n  set height(V) {\n    this.setAttribute(\"height\", String(V));\n  }\n  get width() {\n    return this.hasAttribute(\"width\") ? conversions[\"unsigned long\"](this.getAttribute(\"width\")) : this.naturalWidth;\n  }\n  set width(V) {\n    this.setAttribute(\"width\", String(V));\n  }\n  get naturalHeight() {\n    return this._image ? this._image.height : 0;\n  }\n  get naturalWidth() {\n    return this._image ? this._image.width : 0;\n  }\n  get complete() {\n    return Boolean(this._image && this._image.complete);\n  }\n  get currentSrc() {\n    return this._currentSrc || \"\";\n  }\n  get lowsrc() {\n    return reflectURLAttribute(this, \"lowsrc\");\n  }\n  set lowsrc(value) {\n    this.setAttribute(\"lowsrc\", value);\n  }\n  get longDesc() {\n    return reflectURLAttribute(this, \"longdesc\");\n  }\n  set longDesc(value) {\n    this.setAttribute(\"longdesc\", value);\n  }\n}\nmodule.exports = {\n  implementation: HTMLImageElementImpl\n};","map":{"version":3,"names":["conversions","require","HTMLElementImpl","implementation","resourceLoader","Canvas","reflectURLAttribute","HTMLImageElementImpl","_attrModified","name","value","oldVal","document","_ownerDocument","_hasFeature","error","_image","Image","onerror","err","_currentSrc","hasAttribute","load","src","data","url","response","statusCode","undefined","Error","source","_accept","setAttribute","srcset","USVString","getAttribute","height","naturalHeight","V","String","width","naturalWidth","complete","Boolean","currentSrc","lowsrc","longDesc","module","exports"],"sources":["G:/scientificKeyboard/keyboard/node_modules/mathjax-node/node_modules/jsdom/lib/jsdom/living/nodes/HTMLImageElement-impl.js"],"sourcesContent":["\"use strict\";\nconst conversions = require(\"webidl-conversions\");\nconst HTMLElementImpl = require(\"./HTMLElement-impl\").implementation;\nconst resourceLoader = require(\"../../browser/resource-loader\");\nconst { Canvas, reflectURLAttribute } = require(\"../../utils\");\n\nclass HTMLImageElementImpl extends HTMLElementImpl {\n  _attrModified(name, value, oldVal) {\n    if (name === \"src\" && value !== oldVal) {\n      const document = this._ownerDocument;\n      if (Canvas && document.implementation._hasFeature(\"FetchExternalResources\", \"img\")) {\n        let error;\n        if (!this._image) {\n          this._image = new Canvas.Image();\n          // Install an error handler that just remembers the error. It is then\n          // thrown in the callback of resourceLoader.load() below.\n          this._image.onerror = function (err) {\n            error = err;\n          };\n        }\n        this._currentSrc = null;\n        if (this.hasAttribute(\"src\")) {\n          resourceLoader.load(this, this.src, {}, (data, url, response) => {\n            if (response && response.statusCode !== undefined && response.statusCode !== 200) {\n              throw new Error(\"Status code: \" + response.statusCode);\n            }\n            error = null;\n            this._image.source = data;\n            if (error) {\n              throw new Error(error);\n            }\n            this._currentSrc = value;\n          });\n        } else {\n          this._image.source = undefined;\n        }\n      }\n    }\n\n    super._attrModified(name, value, oldVal);\n  }\n\n  get _accept() {\n    return \"image/png,image/*;q=0.8,*/*;q=0.5\";\n  }\n\n  get src() {\n    return reflectURLAttribute(this, \"src\");\n  }\n\n  set src(value) {\n    this.setAttribute(\"src\", value);\n  }\n\n  get srcset() {\n    return conversions.USVString(this.getAttribute(\"srcset\"));\n  }\n\n  set srcset(value) {\n    this.setAttribute(\"srcset\", value);\n  }\n\n  get height() {\n    // Just like on browsers, if no width / height is defined, we fall back on the\n    // dimensions of the internal image data.\n    return this.hasAttribute(\"height\") ?\n           conversions[\"unsigned long\"](this.getAttribute(\"height\")) :\n           this.naturalHeight;\n  }\n\n  set height(V) {\n    this.setAttribute(\"height\", String(V));\n  }\n\n  get width() {\n    return this.hasAttribute(\"width\") ?\n           conversions[\"unsigned long\"](this.getAttribute(\"width\")) :\n           this.naturalWidth;\n  }\n\n  set width(V) {\n    this.setAttribute(\"width\", String(V));\n  }\n\n  get naturalHeight() {\n    return this._image ? this._image.height : 0;\n  }\n\n  get naturalWidth() {\n    return this._image ? this._image.width : 0;\n  }\n\n  get complete() {\n    return Boolean(this._image && this._image.complete);\n  }\n\n  get currentSrc() {\n    return this._currentSrc || \"\";\n  }\n\n  get lowsrc() {\n    return reflectURLAttribute(this, \"lowsrc\");\n  }\n\n  set lowsrc(value) {\n    this.setAttribute(\"lowsrc\", value);\n  }\n\n  get longDesc() {\n    return reflectURLAttribute(this, \"longdesc\");\n  }\n\n  set longDesc(value) {\n    this.setAttribute(\"longdesc\", value);\n  }\n}\n\nmodule.exports = {\n  implementation: HTMLImageElementImpl\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}